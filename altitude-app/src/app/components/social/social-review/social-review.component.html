<app-header></app-header>

<!-- Toast for notifications -->
<p-toast position="top-right" [breakpoints]="{'920px': {width: '100%', right: '0', left: '0'}}"></p-toast>

@if (loading) {
<app-loader></app-loader>
} @else {
<div class="fade-in" style="min-height: 110vh;">
  <div
    class="max-w-[90%] my-8 mx-auto p-8 border-2 border-[#B66DFF] rounded-2xl flex flex-col justify-center items-center">
    <div class="flex w-full flex-wrap justify-between items-center">
      <div class="flex flex-col justify-center gap-2">
        <div class="flex items-center gap-2">
          <a routerLink="/generate-request" class="text-2xl cursor-pointer">
            <i class="pi pi-angle-left mr-1"></i>Social Media Post
            <i class="pi pi-pencil ml-1"></i>
          </a>
        </div>
        <div class="flex items-center gap-2">
          <a class="text-decoration-none p-3 rounded-full border-1 border-[#363636] flex gap-2">
            <img src="assets/images/InstagramLogo.svg" />Social Media Campaign
          </a>
          <a class="text-decoration-none p-3 text-[#9B9B9B] rounded-full border-1 border-[#363636]">
            {{ currentsDate }}
          </a>
        </div>
      </div>
      <div>
        <button (click)="showAgenticWorkflow = true"
          class="border border-2 border-[#BB93FF] text-[#BB93FF] px-5 py-3 rounded-full">
          Agentic Workflow
        </button>
      </div>
    </div>

    <!-- Agentic Workflow Drawer -->
    <p-drawer [(visible)]="showAgenticWorkflow" position="right" [style]="{width: '600px'}" [modal]="true"
      header="Agentic Workflow">
      <div class="workflow-container p-4">
        <svg class="workflow-svg" width="100%" height="600" viewBox="0 0 550 600">
          <defs>
            <!-- Arrow markers - smaller size -->
            <marker id="arrowGreen" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto"
              markerUnits="strokeWidth">
              <path d="M0,0 L0,6 L6,3 z" fill="#22c55e" />
            </marker>
            <marker id="arrowYellow" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto"
              markerUnits="strokeWidth">
              <path d="M0,0 L0,6 L6,3 z" fill="#eab308" />
            </marker>
            <marker id="arrowGray" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto"
              markerUnits="strokeWidth">
              <path d="M0,0 L0,6 L6,3 z" fill="#6b7280" />
            </marker>
          </defs>

          <!-- Workflow nodes and connections -->
          <ng-container *ngFor="let agent of getWorkflowAgents(); let i = index; trackBy: trackByIndex">
            <!-- Connection line from previous node -->
            <ng-container *ngIf="i > 0">
              <line [attr.x1]="275" [attr.y1]="70 + (i - 1) * 120 + 80" [attr.x2]="275" [attr.y2]="70 + i * 120"
                stroke="#22c55e" stroke-width="2" marker-end="url(#arrowGreen)" />
            </ng-container>

            <!-- Agent node -->
            <g [attr.transform]="'translate(100, ' + (70 + i * 120) + ')'">
              <rect x="0" y="0" width="350" height="80" rx="10" fill="#1e3a2e" stroke="#b66dff" stroke-width="2" />

              <!-- Status icon -->
              <circle [attr.cx]="20" [attr.cy]="40" r="8" fill="#22c55e" />

              <!-- Agent name -->
              <text x="40" y="35" fill="#fff" font-size="16" font-weight="600">
                {{ agent.name | titlecase }}
              </text>

              <!-- Status text -->
              <text x="40" y="55" fill="#86efac" font-size="12">
                Status: COMPLETED
              </text>
            </g>
          </ng-container>
        </svg>
      </div>
    </p-drawer>

    <div class="flex flex-wrap mt-5 gap-4 w-full">
      <div class="md:flex-1">
        <div>
          <!-- Accordion panels -->
          <p-accordion value="0" class="bg-[#121212]">
            <p-accordion-panel value="0">
              <p-accordion-header class="border-1 p-4 bg-[#121212] border-b-0 rounded-t-xl border-[#363636]">
                Brand Guidelines & Assets
              </p-accordion-header>
              <p-accordion-content class="p-4 bg-[#121212] border-1 border-[#363636]">
                <h4 class="text-[#9B9B9B] mb-2">Edit Brand Colors</h4>
                <div class="flex justify-center gap-4 items-center">
                  <div class="flex w-20 flex-col items-center justify-center rounded-xl bg-[#1A1A1A] p-3">
                    <a class="p-4 mb-1 rounded-full bg-[#E41E28]"></a>
                    <p>Primary</p>
                  </div>
                  <div class="flex w-20 flex-col items-center justify-center rounded-xl bg-[#1A1A1A] p-3">
                    <a class="p-4 mb-1 rounded-full bg-[#CBEBFC]"></a>
                    <p>Secondary</p>
                  </div>
                  <div class="flex w-20 flex-col items-center justify-center rounded-xl bg-[#1A1A1A] p-3">
                    <a class="p-4 mb-1 rounded-full bg-[#3F3F3F]"></a>
                    <p>Tertiary</p>
                  </div>
                  <div class="flex w-20 flex-col items-center justify-center rounded-xl bg-[#1A1A1A] p-3">
                    <a class="p-4 mb-1 rounded-full bg-[#B5876D]"></a>
                    <p>Accent</p>
                  </div>
                </div>
              </p-accordion-content>
            </p-accordion-panel>
          </p-accordion>

          <p-accordion value="1">
            <p-accordion-panel value="1">
              <p-accordion-header class="bg-[#121212] border-s-1 border-e-1 rounded-none p-4 border-[#363636]">
                Task Details
              </p-accordion-header>
              <p-accordion-content class="p-4 bg-[#121212] border-1 border-[#363636] rounded-b-xl">
                <div class="flex justify-between items-start">
                  <div class="grid grid-cols-2 gap-y-4 gap-x-6 text-base text-white">
                    <div class="flex flex-col">
                      <span class="text-[#9b9b9b] text-sm">Client Name</span>
                      <span class="font-semibold">{{ formData?.brand || brand || '-' }}</span>
                    </div>
                    <div class="flex flex-col">
                      <span class="text-[#9b9b9b] text-sm">Purpose</span>
                      <span class="font-semibold">{{ formData?.purpose || '-' }}</span>
                    </div>
                    <div class="flex flex-col">
                      <span class="text-[#9b9b9b] text-sm">Topic</span>
                      <span class="font-semibold">{{ formData?.topic || '-' }}</span>
                    </div>
                    <div class="flex flex-col">
                      <span class="text-[#9b9b9b] text-sm">Due Date</span>
                      <span class="font-semibold">{{ formData?.dueDate || '-' }}</span>
                    </div>
                    <div class="flex flex-col">
                      <span class="text-[#9b9b9b] text-sm">Word Limit</span>
                      <span class="font-semibold">{{ formData?.wordLimit || '-' }}</span>
                    </div>
                    <div class="flex flex-col">
                      <span class="text-[#9b9b9b] text-sm">Platform</span>
                      <span class="font-semibold">{{ formData?.campaign || '-' }}</span>
                    </div>
                    <div class="flex flex-col">
                      <span class="text-[#9b9b9b] text-sm">Image Option</span>
                      <span class="font-semibold">{{ formData?.imageOpt || '-' }}</span>
                    </div>
                    <div class="flex flex-col col-span-2">
                      <span class="text-[#9b9b9b] text-sm">Image Description</span>
                      <span class="font-semibold">{{ formData?.imgDesc || '-' }}</span>
                    </div>
                    <div class="flex flex-col col-span-2">
                      <span class="text-[#9b9b9b] text-sm">Additional Details</span>
                      <span class="font-semibold">{{ formData?.additional || '-' }}</span>
                    </div>
                  </div>
                </div>
              </p-accordion-content>
            </p-accordion-panel>
          </p-accordion>
        </div>
      </div>

      <div class="md:flex-2">
        <div class="flex flex-col">
          <p-tabs [(value)]="activeTabIndexa">
            <div class="rounded-t-xl bg-[#363636]">
              <div class="flex justify-between items-center p-4 flex-wrap">
                <div class="flex items-center gap-2">
                  <button class="bg-[#8D4BFF] rounded-full py-4 px-5" disabled>
                    <i class="pi pi-sparkles"></i>
                  </button>
                  <h2 class="text-2xl font-bold">Generated Results</h2>
                </div>

                <p-tablist class="p-3 border-[#4D4D4D] rounded-full items-center bg-[#363636]">
                  <div class="flex gap-4 items-center justify-center bg-[#09040E]">
                    <p-tab *ngFor="let campaign of activeCampaigns; let i = index" [value]="i"
                      class="gap-2 p-4 bg-[#363636]">{{ campaign }}</p-tab>
                  </div>
                </p-tablist>

                <div class="flex items-center gap-2">
                  <img src="assets/images/ListMagnifyingGlass.svg" alt="" />
                  <p class="font-semibold text-lg" style="cursor: pointer" (click)="onCreateProject()">
                    Check Plagiarism
                  </p>
                </div>
              </div>
            </div>

            <div class="border-t-1 border-[#686868] bg-[#363636] p-5 rounded-b-xl">
              <div class="flex my-4 flex-col justify-center items-center">
                <div class="flex justify-center items-center relative">
                  <!-- Loading Spinner Overlay -->
                  <div *ngIf="isRegeneratingContent || isRegeneratingImage"
                    class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-2xl z-10">
                    <p-progressSpinner styleClass="w-16 h-16" strokeWidth="4" fill="transparent"
                      animationDuration=".8s"></p-progressSpinner>
                  </div>

                  <p-tabpanels
                    class="bg-[#F6F5EF] rounded-2xl border-4 shadow-xl max-w-3xl w-full overflow-hidden p-16">
                    <p-tabpanel *ngFor="let campaign of activeCampaigns; let i = index" [value]="i">
                      <ng-container [ngSwitch]="campaign">
                        <!-- Facebook Panel -->
                        <div *ngSwitchCase="'Facebook'">
                          <h3 class="post-caption text-black dark:text-black text-white">
                            {{ editorContentSocialMedia }}
                          </h3>
                          <p *ngIf="hyperUrl" class="post-caption text-black">
                            For more details, visit our website:
                            <a [href]="hyperUrl" target="_blank" rel="noopener noreferrer" style="color: #0866ff">
                              {{ hyperUrl }}
                            </a>
                          </p>
                          <img *ngIf="imageFBUrlSocialmedia" [src]="imageFBUrlSocialmedia" alt="Facebook Post"
                            class="post-image mt-3" />
                        </div>

                        <!-- Instagram Panel -->
                        <div *ngSwitchCase="'Instagram'">
                          <div class="instagram-post">
                            <img *ngIf="imageInstaUrlSocialmedia" [src]="imageInstaUrlSocialmedia" alt="Instagram Post"
                              class="post-image" />
                            <p class="post-caption text-black mt-3">
                              {{ editorContentSocialMedia1 }}
                            </p>
                            <p *ngIf="hyperUrl" class="post-caption text-black">
                              For more details, visit our website:
                              <a [href]="hyperUrl" target="_blank" rel="noopener noreferrer" style="color: #0866ff">
                                {{ hyperUrl }}
                              </a>
                            </p>
                          </div>
                        </div>

                        <!-- X Panel -->
                        <div *ngSwitchCase="'X'">
                          <div class="instagram-post">
                            <img *ngIf="imageXUrlSocialmedia" [src]="imageXUrlSocialmedia" alt="Instagram Post"
                              class="post-image" />
                            <p class="post-caption text-black mt-3">
                              {{ contentXSocialMedia }}
                            </p>
                            <p *ngIf="hyperUrl" class="post-caption text-black">
                              For more details, visit our website:
                              <a [href]="hyperUrl" target="_blank" rel="noopener noreferrer" style="color: #0866ff">
                                {{ hyperUrl }}
                              </a>
                            </p>
                          </div>
                        </div>

                        <!-- LinkedIn Panel -->
                        <div *ngSwitchCase="'LinkedIn'">
                          <div class="instagram-post">
                            <img *ngIf="imageLinkedInUrlSocialmedia" [src]="imageLinkedInUrlSocialmedia"
                              alt="Instagram Post" class="post-image" />
                            <p class="post-caption text-black mt-3">
                              {{ contentLinkdInSocialMedia }}
                            </p>
                            <p *ngIf="hyperUrl" class="post-caption text-black">
                              For more details, visit our website:
                              <a [href]="hyperUrl" target="_blank" rel="noopener noreferrer" style="color: #0866ff">
                                {{ hyperUrl }}
                              </a>
                            </p>
                          </div>
                        </div>

                        <!-- Default -->
                        <div *ngSwitchDefault>
                          <p>No content available for this campaign.</p>
                        </div>
                      </ng-container>
                    </p-tabpanel>
                  </p-tabpanels>
                </div>
              </div>

              <div class="flex items-center gap-2 mt-4">
                <button (click)="appendToContentFeedback('Use an informal tone for communication')"
                  class="border-1 border-white rounded-full p-3 hover:bg-[#8D4BFF] transition cursor-pointer">
                  Use an informal tone for communication
                </button>
                <button (click)="appendToContentFeedback('Use 200 words')"
                  class="border-1 border-white rounded-full p-3 hover:bg-[#8D4BFF] transition cursor-pointer">
                  Use 200 words
                </button>
              </div>

              <!-- Regeneration Sections -->
              <div class="w-full mt-6 mb-6">
                <!-- Regenerate Content Section -->
                <div class="regeneration-section">
                  <label class="regeneration-label">
                    <i class="pi pi-refresh mr-2"></i>Regenerate Content
                  </label>
                  <div class="bg-[#1A1A1A] rounded-2xl px-4 py-3 flex items-center gap-2 shadow-inner"
                    style="box-shadow: 0 2px 16px 0 #00000040">
                    <input pInputText [(ngModel)]="contentFeedback"
                      class="flex-1 bg-transparent border-none text-white text-lg placeholder-gray-400 focus:ring-0 focus:border-0 outline-none"
                      placeholder="Type your feedback to regenerate content" [disabled]="isRegeneratingContent"
                      style="height: 48px" />
                    <button (click)="regenerateContent()" [disabled]="isRegeneratingContent"
                      class="w-12 h-12 flex items-center justify-center rounded-lg bg-[#8D4BFF] hover:bg-[#B66DFF] transition disabled:opacity-50 disabled:cursor-not-allowed">
                      <i *ngIf="!isRegeneratingContent" class="pi pi-send text-2xl text-white"></i>
                      <p-progressSpinner *ngIf="isRegeneratingContent" styleClass="w-6 h-6" strokeWidth="4"
                        fill="transparent" animationDuration=".8s"></p-progressSpinner>
                    </button>
                  </div>
                </div>

                <!-- Regenerate Image Section -->
                <div class="regeneration-section mt-4">
                  <label class="regeneration-label">
                    <i class="pi pi-image mr-2"></i>Image Regenerate
                  </label>
                  <div class="bg-[#1A1A1A] rounded-2xl px-4 py-3 flex items-center gap-2 shadow-inner"
                    style="box-shadow: 0 2px 16px 0 #00000040">
                    <input pInputText [(ngModel)]="imageFeedback"
                      class="flex-1 bg-transparent border-none text-white text-lg placeholder-gray-400 focus:ring-0 focus:border-0 outline-none"
                      placeholder="Type your feedback to regenerate image" [disabled]="isRegeneratingImage"
                      style="height: 48px" />
                    <button (click)="regenerateImage()" [disabled]="isRegeneratingImage"
                      class="w-12 h-12 flex items-center justify-center rounded-lg bg-[#8D4BFF] hover:bg-[#B66DFF] transition disabled:opacity-50 disabled:cursor-not-allowed">
                      <i *ngIf="!isRegeneratingImage" class="pi pi-send text-2xl text-white"></i>
                      <p-progressSpinner *ngIf="isRegeneratingImage" styleClass="w-6 h-6" strokeWidth="4"
                        fill="transparent" animationDuration=".8s"></p-progressSpinner>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </p-tabs>
        </div>
      </div>
    </div>
  </div>
  <div class="flex justify-end mr-4 mb-8">
    <p-button class="bg-[#8D4BFF] p-4 rounded-full" label="Send For Approval" (onClick)="navigateToForm()"></p-button>
  </div>
</div>
}